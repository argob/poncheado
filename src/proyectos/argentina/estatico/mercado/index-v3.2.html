---
layout: argentina
---

<div class="container">
  <section>
    <div id="ferias">

      <h3 id="cerca-barrio" class="text-center m-t-0">¡Buscá qué día estará la feria cerca de tu casa!</h3>
      <div class="row">
        <div class="col-md-8 col-md-offset-2">    
          <div class="form-group m-b-2">
            <input class="form-control search" placeholder="Filtrá las ferias por municipio, día o barrio...">
          </div>
        </div>
      </div>

      <div class="well">
        <h4 class="m-t-2">Esta semana estamos en: </h4>
        <div class="table-responsive">
          <table id="table-semana" class="table table-align-middle">
            <thead>
              <tr>
                <th><a class="sort" data-sort="dia">Día <span class="caret"></span></a></th>
                <th><a class="sort" data-sort="timestamps">Fecha <span class="caret"></span></a></th>
                <th style="width: 140px;"><a class="sort" data-sort="provincia">Provincia <span class="caret"></span></a></th>
                <th><a class="sort" data-sort="barrio">Municipio <span class="caret"></span></a></th>
                <th><a class="sort" data-sort="lugar">Barrio <span class="caret"></span></a></th>
                <th style="width: 120px;" class="text-right">Mapa</th>
              </tr>
            </thead>
            <tbody class="list" id="ferias-semana">
            </tbody>
          </table>
        </div>
      </div>

      <div class="well">
        <h4 class="m-t-2">Las próximas semanas estaremos en: </h4>
        <div class="table-responsive">
          <table id="table-proximas" class="table table-align-middle">
            <thead>
              <tr>
                <th><a class="sort" data-sort="dia">Día <span class="caret"></span></a></th>
                <th><a class="sort" data-sort="timestamps">Fecha <span class="caret"></span></a></th>
                <th style="width: 140px;"><a class="sort" data-sort="provincia">Provincia <span class="caret"></span></a></th>
                <th><a class="sort" data-sort="barrio">Municipio <span class="caret"></span></a></th>
                <th><a class="sort" data-sort="lugar">Barrio <span class="caret"></span></a></th>
                <th style="width: 120px;" class="text-right">Mapa</th>
              </tr>
            </thead>
            <tbody class="list" id="ferias-proximas">
            </tbody>
          </table>
        </div> 
      </div>

    </div>
  </section>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/locale/es.js"></script>

<script>

jQuery(function(){

  window.ferias = {
    semana: [],
    proximas: []
  }

  var test = 0;

  jQuery.getJSON('https://spreadsheets.google.com/feeds/list/1gDUaA7UVYxMNmY4Gww150S8yYBdVBfMvAGovHHQ5FfM/1/public/values?alt=json', 
    function (data) {
      window.raw = data.feed.entry;

      jQuery.each( raw, function( key, item ) {
        var fecha = moment(item.gsx$fecha.$t, "DD/MM/YYYY");
        
        if( fecha.startOf('day').isBetween( moment().startOf('day').add(test, 'day'), moment().add(test, 'day').day(7) ) ){
          ferias.semana.push( item );

        } else if( fecha.startOf('day').isAfter( moment().add(test, 'day').day(7) ) ){
          ferias.proximas.push( item );
        }
      });

      printFerias();
  });

  var getTr = function(item){

    var mapa = '';

    if(item.gsx$mapa.$t != '') {
      mapa = '<a class="btn btn-primary btn-sm m-b-0" style="min-width: 100px;" target="_blank" href="'+ item.gsx$mapa.$t + '"><i class="fa fa-map-marker"></i> Ver mapa</a>';
    }

    var fecha= item.gsx$fecha.$t;
    var fechaParts = fecha.split("/");
    var date = new Date(fechaParts[2], fechaParts[1] - 1, fechaParts[0]);
    var timestamps = +date

    var html = '<tr class="item">';
        html += '<td class="dia">'+ item.gsx$dia.$t + '</td>';
        html += '<td class="fecha"><span class="hidden timestamps">'+ timestamps + '</span>'+ item.gsx$fecha.$t + '</td>';
        html += '<td class="provincia">'+ item.gsx$provincia.$t + '</td>';
        html += '<td class="barrio">'+ item.gsx$barrio.$t + '</td>';
        html += '<td class="lugar">'+ item.gsx$lugar.$t + '</td>';
        html += '<td class="mapa text-right">'+ mapa + '</td></tr>';

    return html;
  }

  window.printFerias = function(){

    // console.log(ferias);

    jQuery.each( ferias.semana, function( key, item ) {
      jQuery('#ferias-semana').append( getTr( item, false ) );
    });
    
    jQuery.each( ferias.proximas, function( key, item ) {
      jQuery('#ferias-proximas').append( getTr( item, false ) );
    });


    var listOptions = {
      valueNames: [ 'barrio', 'dia', 'timestamps', 'provincia', 'lugar' ]
    };

    var feriasSemanaList = new List('table-semana', listOptions);
    var feriasProximasList = new List('table-proximas', listOptions);



    jQuery('.search').on("keyup",function(){
        var valueSearch = jQuery(".search").val();

         stripVowelAccent(valueSearch);  

        console.log(valueSearch);
        feriasSemanaList.fuzzySearch(valueSearch);
        feriasProximasList.fuzzySearch(valueSearch);
    });

  }


  function stripVowelAccent(str) {
   var rExps=[
   {re:/[\xC0-\xC6]/g, ch:'A'},
   {re:/[\xE0-\xE6]/g, ch:'a'},
   {re:/[\xC8-\xCB]/g, ch:'E'},
   {re:/[\xE8-\xEB]/g, ch:'e'},
   {re:/[\xCC-\xCF]/g, ch:'I'},
   {re:/[\xEC-\xEF]/g, ch:'i'},
   {re:/[\xD2-\xD6]/g, ch:'O'},
   {re:/[\xF2-\xF6]/g, ch:'o'},
   {re:/[\xD9-\xDC]/g, ch:'U'},
   {re:/[\xF9-\xFC]/g, ch:'u'},
   {re:/[\xD1]/g, ch:'N'},
   {re:/[\xF1]/g, ch:'n'} ];

   for(var i=0, len=rExps.length; i<len; i++)
    str=str.replace(rExps[i].re, rExps[i].ch);

   return str;
  }


});

</script>


