---
layout: argentina
---


<section id="test-section" class="state-loading">
  <div class="container">

    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <div class="test-container">
          <h2>Buscá información para esta situación</h2>
          <blockquote id="question" class="lead m-t-3 m-b-4"></blockquote>
          <p class="m-b-2"><a id="reloadButton" href="#"> Probar con otra situación</a></p>
          <hr>
          
          <p class="m-b-3"><strong>Elegí una opción</strong> del siguiente menú donde creas que podés encontrar lo que estás buscando:</p>          
          <div id="test-list" role="tablist" aria-multiselectable="true"></div>
        </div>
      </div>
    </div>
  </div>
</section>


<style>
  blockquote {
    padding-left: 1em;
    margin-left: 1em;
    border-left: 4px solid #EEE;
  }
  #test-list .panel-heading {
    cursor: pointer;
  }
  #test-list .panel-body {
    border-top: 1px solid #EEE;
    padding-top: 0;
    padding-bottom: 0;
  }
  #test-list .panel-body p {
    margin: 0;
  }
  #test-list .panel-body p:first-of-type {
    margin-top: 10px;
  }
  #test-list .panel-body p:last-of-type {
    margin-bottom: 10px;
  }
  #test-list .panel-body p a:not(.btn) {
    display: inline-block;
    padding: 5px 0;
  }
</style>

<script>

(function($){

  var raw;
  var data = {
    list: [],
    contents: {},
    questions: [],
    question,
    results:{
      start: Date.now(),
      finish: null,
      result: null,
      groups: 0,
      contents: 0,
      flow: []
    },
    user: {}
  };

  if(typeof(Storage) !== "undefined") {
    if( localStorage.getItem("testUser") != undefined ){
      var localUser = JSON.parse( localStorage.getItem("testUser"))

      $.each(localUser, function(key, item){
          if(item.name == 'edad'){
            data.user.age = item.value;
          }else if(item.name == 'provincia'){
            data.user.province = item.value;
          }
      })

    }else{

      window.location.href = '/mejorar';

    }
  } else {
    console.log('No tenés soporte :(');
  } 


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71585203-12', 'auto', 'ux');

  var shuffle = function (array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }

  var renderList = function(){
    jQuery.each(raw, function(index, row){
      if(data.contents[row.gsx$agrupador.$t] == undefined){
        data.contents[row.gsx$agrupador.$t] = [row.gsx$caso.$t];
        data.list.push(row.gsx$agrupador.$t);

      }else if(data.contents[row.gsx$agrupador.$t].indexOf(row.gsx$caso.$t) < 0){
        data.contents[row.gsx$agrupador.$t].push(row.gsx$caso.$t)
      }

      if(row.gsx$contenido.$t != ''){
        data.questions.push({
          text: row.gsx$contenido.$t,
          group:row.gsx$agrupador.$t,
          content: row.gsx$caso.$t,
          id: row.gsx$id.$t
        })
      }
    });

    var $list = jQuery('#test-list');
    var html = '<div id="test">';
    data.list = shuffle(data.list);

    jQuery.each(data.list, function( groupIndex, group ){

        html += '<div class="panel m-b-1" role="tab"><div class="panel-heading" data-toggle="collapse" href="#group-'+ groupIndex +'" data-parent="#test"><h4>'+ group +'</h4></div> <div class="panel-body collapse" role="tabpanel" id="group-'+ groupIndex +'">';
        cases = shuffle(data.contents[group]);

        jQuery.each(cases, function(index, content){
          html += '<p><a href="#">'+ content +'</a></p>';
        });

        html += '</div></div>';    

    });

    data.question = data.questions[ Math.floor( Math.random() * data.questions.length ) ]
    jQuery('#question').text( data.question.text );
    $list.append(html);
    jQuery('#test-section').removeClass('state-loading');

  }

  var anotherQuestion = function(){

    ga('ux.send', {
      hitType: 'event',
      eventCategory: 'Árbol - Casos de vida',
      eventAction: 'Cambio de situación',
      eventLabel: JSON.stringify( [ data.question, data.user] )
    });

    data.question = data.questions[ Math.floor( Math.random() * data.questions.length ) ]
    jQuery('#question').text( data.question.text );
  }



  jQuery('body').on('click', '#test-list .panel-heading', function(event){
    event.preventDefault();
    data.results.groups ++;
    data.results.flow.push( 'A | '+ jQuery(this).find('h4').text() );
    jQuery('#reloadButton').addClass('invisible');
  })
  .on('click', '#test-list .panel-body a', function(event){
    
    if( jQuery(this).hasClass('btn-selector') ){
      
      data.results.result = jQuery(this).prev().text() == data.question.content;
      data.results.finish = Date.now();

      ga('ux.send', {
        hitType: 'event',
        eventCategory: 'Árbol - Casos de vida',
        eventAction: 'Finalizado',
        eventLabel: JSON.stringify( [ data.results, data.question, data.user] )
      });

    }else{
      
      jQuery('.btn-selector').remove();
      jQuery(this).parent().append('<a class="btn-selector btn btn-success btn-sm m-b-0 m-l-2" href="/registro-pruebas" style="vertical-align: middle;">Lo buscaría acá</a>')
      event.preventDefault();
      data.results.contents ++;
      data.results.flow.push( 'C | '+ jQuery(this).text() );
    }
  });


  jQuery.getJSON('https://interfaces.argentina.gob.ar/api/public/v1.0/inap/15WrBedfggCBXBPhXEsBRSD3Jrh31BwOC4jM3Ov4clQU/1', function (response) {
    raw = response.feed.entry;
    renderList();
  });

  jQuery('#reloadButton').click( function(event) {
    event.preventDefault();
    anotherQuestion();
  })

})(jQuery);

</script>
