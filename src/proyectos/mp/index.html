<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <!-- Material Design for Bootstrap fonts and icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">

    <!-- Material Design for Bootstrap CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/circle.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <title>MP</title>
        <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    
  </head>
  <body>
   <section id="loader" class="loader"></section>
   <section id="bloques" class="d-none">
        <header class="bmd-layout-header py-3">
            <div class="row">
              <div class="col-sm-3"></div>
              <div class="col-sm-6">
                <h2 class="text-center titulo">SELECCION√Å UN BLOQUE</h2>
              </div>
              <div class="col-sm-3">
                  <button type="button" class="btn btn-secondary active refreshBloque botonRefresh">
                    <i class="material-icons">autorenew</i><span>ACTUALIZAR</span>
                  </button>
              </div>
            </div>
        </header>
        <div class="container-fluid">
          <h3>Bloque activo</h3>
          <section data-render="bloque-activo"></section>
        </div>
        <div class="container-fluid d-none">
          <h3>Bloques Pendientes</h3>
          <section data-render="bloques"></section>
        </div>
        <div class="container-fluid">
          <h3>Bloques respondidos</h3>
          <section data-render="bloques-ok"></section>
        </div>
        <div class="container-fluid">
          <button type="button" class="btn btn-danger btn-secondary active borrarTodo">
            BORRAR TODO
          </button>
        </div>
   </section> 
   <section id="bloque-items" class="d-none">
        <header class="bmd-layout-header py-3">
            <div class="row">
              <div class="col-sm-3">
                <button type="button" class="btn btn-secondary active text-secondary volver">VOLVER</button>
              </div>
              <div class="col-sm-6">
                <h2 class="text-center titulo" data-render="bloque-name"></h2>
              </div>
              <div class="col-sm-3">
                <div class="media-right">
                  <button type="button" class="btn btn-secondary active refreshPartido botonRefresh">
                    <i class="material-icons">autorenew</i><span>ACTUALIZAR</span>
                  </button>
                  </div>
              </div>
            </div>
        </header>
        <div class="container-fluid">
          <h3>Diputados pendientes</h3>
          <section data-render="bloque-items"></section>
        </div>
        <div class="container-fluid">
          <h3>Diputados respondidos</h3>
          <section data-render="bloque-items-ok"></section>
        </div>
   </section>
   <section id="bloque-item-detalle" class="d-none">
        <header class="bmd-layout-header py-3">
            <div class="row">
              <div class="col-sm-3">
                <button type="button" class="btn btn-secondary active text-secondary volver">VOLVER</button>
              </div>
              <div class="col-sm-6">
                <h2 class="text-center titulo" data-render="bloque-name"></h2>
              </div>
              <div class="col-sm-3"></div>
            </div>
        </header>
        <div>
          <section data-render="bloque-item-detalle"></section>
        </div>
   </section>

<script src="js/jquery.min.js"></script>
    <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js" integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9" crossorigin="anonymous"></script>
    <script>$(document).ready(function() { $('body').bootstrapMaterialDesign(); });</script>
     <script src="https://www.argentina.gob.ar/profiles/argentinagobar/themes/argentinagobar/argentinagobar_theme/js/listjs/list.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/list.pagination.js/0.1.1/list.pagination.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/db.js"></script>
    <script src="js/lockr.js"></script>

<script>


  $(function(){

    if(!Lockr.get('bloques')){
      console.log("no existe Lockr entonces lo creo");
      Lockr.set('bloques', bloques);
    }

    var marta = JSON.parse(localStorage.getItem('bloques'));


    window.onload = function() {
    var reloading = sessionStorage.getItem("reloading");
    if (reloading) {
        sessionStorage.removeItem("reloading");
        actualizarBloque();
    }
}

    var templates = {
      bloques:`
          <div class="card flex-md-row mb-4 box-shadow h-md-250 card-bloque" data-bloque={id}>
            <div class="card-body">
              <div class="media">
                <div class="media-body">
                  <h4 class="titulobloque">{partido}</h4>
                  
                </div>
                <div class="media-right">
                  <p class="lead circulocheck {visible}">
                    <span class="border circle-content rounded-circle">
                      <i class="material-icons md-48 text-primary">check</i>
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>`,
      diputados:`
          <div class="card flex-md-row mb-4 box-shadow h-md-250 card-diputado" data-diputado={id} data-diputado-of-bloque="{bloqueId}">
            <p class="d-none">{partido}</p>
            <div class="card-body contenedordiputado">
              <div class="media">
                <div class="media-left">
                  <img src="{foto}" class="media-object d-md-block" style="width:88px">
                </div>
                <div class="media-body ml-4">
                  <h4 class="titulobloque">{nombre}</h4>
                  <h5 class="text-muted">{provincia}</h5>
                  <h4><span class="badge badge-light text-muted">{keyword}</span></h4>
                </div>
                <div class="media-right">
                  <p class="lead circulocantidades">
                    <span class="border circle-content rounded-circle">
                      <span class="preguntasrespondidas">{preguntasRespondidas}</span>
                      <span>/</span>
                      <span class="contenedorvacio preguntastotales">{preguntasTotales}</span>
                    </span>
                  </p>

                  <p class="lead circulocheck {visible}">
                    <span class="border circle-content rounded-circle">
                      <i class="material-icons md-48 text-primary">check</i>
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>`,
      header_preguntas:`
        <div data-pregunta-of-diputado="{id}" class="d-none card-header-pregunta">
          <div class="card flex-md-row box-shadow h-md-250 mb-2 bg-primary text-white">
              <div class="card-body">
                <div class="media">
                  <div class="media-left">
                    <img src="{foto}" class="card-img-left flex-auto d-md-block">
                  </div>
                  <div class="media-body ml-4">
                    <h4 class="nombrefuncionario">{nombre}</h4>
                    <h5 class="text-light">{provincia}</h5>
                    <p class="d-none partidoTerminar">{partido}</p>
                  </div>
                  <div class="media-right">
                    <button type="button" class="btn btn-secondary active terminar">
                      <i class="material-icons">check_circle</i><span>TERMINAR</span>
                    </button>
                  </div>
                </div>
              </div>
          </div>
          <div id="preguntas" class="owl-carousel" data-render="bloque-item-detalle-container">

          </div>
        </div>`,
      preguntas:`
        <div class="container-fluid">
          <div class="d-none card-pregunta">
            <div class="message-wrapper them">
              <div class="circle-wrapper">
                <img src="{foto}" class="rounded-circle img-responsive">
              </div>
              <div class="text-wrapper">
                <h3>{keyword}</h3>
                <p>{pregunta}</p>
              </div>
            </div>          
            <div class="card flex-md-row mb-4 h-md-250">
              <div class="card-body p-0">
                {alerta}
              </div>
            </div>
            <div class="card flex-md-row mb-4 box-shadow h-md-250">
              <div class="card-body">
                {miRespuestaFinal}
              </div>
            </div>
            <div class="card flex-md-row mb-4 box-shadow h-md-250">
              <div class="card-body">
                {miObservacionFinal}
              </div>
            </div>
          </div>
        </div>`
    }

    var preguntas = [];
    var bloqueActivo = null;
    let onselected = false;


function todo(){
    $.ajax({
      url: 'https://spreadsheets.google.com/feeds/list/14j6f5CFP2_wYLo5B-I7VxIrCbP3gGHcNAwUGbYoNRLE/1/public/values?alt=json',
      data: 'json',
      success: function(response){
        //console.log(response.feed.entry);

        $.each(response.feed.entry, function(index, row){
        //console.log(row);
            preguntas.push({
              index: index,
              nombre: row.gsx$legislador.$t,
              provincia: row.gsx$provincia.$t,
              partido: row.gsx$partido.$t,
              foto: row.gsx$foto.$t,
              pregunta: row.gsx$pregunta.$t,
              keyword: row.gsx$keyword.$t,
              orden: row.gsx$ordenlegislador.$t,
              numero: row.gsx$npregunta.$t,
              respuestageneral: row.gsx$respuestageneral.$t,
              respuestageneralstatu: row.gsx$respuestageneralstatu.$t,
              respuestapolitica: row.gsx$respuestapolitica.$t,
              respuestapoliticastatus: row.gsx$respuestapoliticastatus.$t,
              respuestafinal: row.gsx$respuestafinal.$t,
              respuestafinalmodifica: row.gsx$respuestafinalmodifica.$t,
              respuestaseleccionada: row.gsx$respuestaseleccionada.$t,
              observacion: row.gsx$observacion.$t,
              observacionmodificada: row.gsx$observacionmodificada.$t,
              observacionseleccioanda: row.gsx$observacionseleccioanda.$t,
              okmoderador: row.gsx$okmoderador.$t,
              cantpreguntas: row.gsx$cantpreguntas.$t,
              cantpreguntasrespondidas: row.gsx$cantpreguntasrespondidas.$t,
              nousar1: row.gsx$nousar1.$t,
              nousar2: row.gsx$nousar2.$t,
              nousar3: row.gsx$nousar3.$t,
              publicado: row.gsx$publicado.$t,
              timestamp: row.gsx$timestamp.$t
            });
        });


        setTimeout(function(){


          $(".owl-carousel").owlCarousel(
            $('.owl-carousel').owlCarousel({
              nav:true,
              items:1
            })
          ); 


        $('.owl-carousel').on('changed.owl.carousel', function(e) {
        

          console.log('The current item is at index', e.item.index);
          console.log('The total items are', e.item.count);
          
          $( ".owl-nav" ).find('p').remove();

          $( ".owl-prev" ).after( "<p>" + (e.item.index + 1) + " de " + e.item.count + "</p>" );

          


        });



        }, 1000);
        

        bloqueActivo = localStorage.getItem('bloque');
        if (!bloqueActivo){
          bloqueActivo = preguntas[0].partido;
          localStorage.setItem('bloqueActivo', bloqueActivo);
        }
        render.Pages();
        $('#bloques').toggleClass('d-none', 'visible');
        $('#loader').toggleClass('loader', 'd-none');

        function hideAllBlocks() {
          $('.card-diputado').addClass('d-none');
          $('.card-diputado').removeClass('visible');
          $('#bloques').removeClass('visible');
          $('#bloques').addClass('d-none');
          $('#bloque-items').removeClass('visible');
          $('#bloque-items').addClass('d-none');
          $('#bloque-item-detalle').removeClass('visible');
          $('#bloque-item-detalle').addClass('d-none');

        }

        function oc_card_bloque(this_bloque){
          console.log("oc_");
          setTimeout(()=>{
            if (!onselected){
              var bloque = $(this_bloque).data('bloque');
              hideAllBlocks();

              var select = '[data-diputado-of-bloque="' + bloque + '"]';
              $(select).removeClass('d-none');
              $(select).addClass('visible');

              $('#bloque-items').removeClass('d-none');
              $('#bloque-items').addClass('visible');

              onselected = true;
              setTimeout(()=>{
                onselected = false;
              },200);
            }
           },200);

        }

        var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        if (isMobile) {
          $('.card-bloque').on('touchend', function(){
            oc_card_bloque(this)
          });
        } else {
          $('.card-bloque').on('click', function(){
            oc_card_bloque(this)
          });

        }

        $(document).on('click', '.card-diputado', function(){
          var diputado = $(this).data('diputado');

          $('.card-pregunta').addClass('d-none');
          $('.card-pregunta').removeClass('visible');

          var select = '[data-pregunta-of-diputado="' + diputado + '"]';
          $(select).removeClass('d-none');
          $(select).addClass('visible');
          var select = '[data-pregunta-of-diputado="' + diputado + '"] .card-pregunta';
          $(select).removeClass('d-none');
          $(select).addClass('visible');

          $('#bloque-items').removeClass('visible');
          $('#bloque-items').addClass('d-none');
          $('#bloque-item-detalle').removeClass('d-none');
          $('#bloque-item-detalle').addClass('visible');
        });


/*

// l√≥gica de diego del bot√≥n terminar

        $('.card-header-pregunta button').on('click', function(){
          var slug_diputado = $(this).parent().parent().parent().data('pregunta-of-diputado');

          var terminates = localStorage.getItem('terminates');
          if (terminates != null){
            terminates = JSON.parse(terminates);
            terminates.push(slug_diputado)
          }
          else{
            terminates = [slug_diputado]
          }
          localStorage.setItem('terminates', JSON.stringify(terminates));

        });

*/

      }
    });
  
    var render = {
      Pages: function( ){
        $('[data-render=bloque-activo]').html('');
        $('[data-render=bloques]').html('');
        $('[data-render=bloques-ok]').html('');
        $('[data-render=bloque-items]').html('');
        $('[data-render=bloque-item-detalle]').html('');

        var bloques = [];
        $.each(preguntas, function(index, pregunta){

          if ( pregunta.nombre !== '' ) {

            var findBloque = bloques.findIndex(function(b) {
              return b.partido == pregunta.partido
            });

            // sino existe el bloque lo agrego
            if (findBloque == -1){
              var diputado = {
                'nombre': pregunta.nombre,
                'foto': pregunta.foto,
                'provincia': pregunta.provincia,
                'keyword': pregunta.keyword,
                'preguntas': [ pregunta ],
                'cantpreguntas': pregunta.cantpreguntas,
                'cantpreguntasrespondidas': pregunta.cantpreguntasrespondidas,
                'terminate': false, // TODO checkearlo con el array terminates del localstorage.getItems "terminates" 
                'orden': pregunta.orden,
              }
              var bloque = {
                'partido': pregunta.partido,
                'index': index,
                'provincia': pregunta.provincia,
                'diputados': [ diputado ],
                'activo': bloqueActivo == pregunta.partido,
                get_status: function(self){
                  for (var i = 0; i < self.diputados.length; i++) {
                    if (!self.diputados[i].terminate){
                      return false
                    }
                  }
                  return true
                },
              };
              bloques.push(bloque)
            }
            else{
              // si existe bloque, veo si existe el diputado
              var findDiputado = bloques[findBloque].diputados.findIndex(function(d) {
                return d.nombre == pregunta.nombre
              });
              // sino existe el disputado lo agrego
              if (findDiputado == -1){
                var diputado = {
                  'nombre': pregunta.nombre,
                  'foto': pregunta.foto,
                  'provincia': pregunta.provincia,
                  'keyword': pregunta.keyword,
                  'preguntas': [ pregunta ],
                  'cantpreguntas': pregunta.cantpreguntas,
                  'cantpreguntasrespondidas': pregunta.cantpreguntasrespondidas,
                  'terminate': false,
                  'orden': pregunta.orden
                }
                bloques[findBloque].diputados.push(diputado)
              }
              else{
                // si existe el diputado
                bloques[findBloque].diputados[findDiputado].preguntas.push(pregunta);
              }
            }

          }

        });

        for (var i = 0; i < bloques.length; i++) {
          // render partido
          this.Bloque(bloques[i])
          //render diputados
          bloques[i].diputados = bloques[i].diputados.sort(function(obj1, obj2) {
            return obj1.orden - obj2.orden;
          });
          
          for (var j = 0; j < bloques[i].diputados.length; j++) {
            this.Diputado(bloques[i], bloques[i].diputados[j])
              //render header preguntas
              this.HeaderPregunta(bloques[i], bloques[i].diputados[j])
              //render preguntas
              for (var k = 0; k < bloques[i].diputados[j].preguntas.length; k++) {
                this.Pregunta(bloques[i], bloques[i].diputados[j], bloques[i].diputados[j].preguntas[k])
              }
          }
          
        }
      },
      Bloque: function(bloque){
        var htmlBloques = templates.bloques;
          var visible = ((bloque.get_status(bloque)) ? 'visible' : 'd-none');
          htmlBloques = htmlBloques
          .replace(/{partido}/gi, bloque.partido)
          .replace(/{id}/gi, bloque.partido.replace(/ /g, "-"))
          .replace(/{index}/gi, bloque.index)
          /*.replace(/{provincia}/gi, bloque.provincia)*/
          .replace(/{visible}/gi, visible);
          if (bloque.get_status(bloque)){
            $('[data-render=bloques-ok]').append( htmlBloques );
          }
          else if (bloqueActivo == bloque.partido){
            $('[data-render=bloque-activo]').append( htmlBloques );
            $('[data-render=bloque-name]').html( bloqueActivo );
          }
          else{
            $('[data-render=bloques]').append( htmlBloques );
          }
      },
      Diputado: function(bloque, diputado){
        var htmlDiputados = templates.diputados;
        var visible = ((diputado.terminate) ? 'visible' : 'd-none');

        htmlDiputados = htmlDiputados
        .replace(/{partido}/gi, bloque.partido)
        .replace(/{id}/gi, diputado.nombre.replace(/ /g, "-"))
        .replace(/{bloqueId}/gi, bloque.partido.replace(/ /g, "-"))
        .replace(/{index}/gi, bloque.index)
        .replace(/{nombre}/gi, diputado.nombre)
        .replace(/{foto}/gi, diputado.foto)
        .replace(/{keyword}/gi, diputado.keyword)
        .replace(/{provincia}/gi, diputado.provincia)
        .replace(/{preguntasTotales}/gi, diputado.cantpreguntas)
        .replace(/{preguntasRespondidas}/gi, diputado.cantpreguntasrespondidas)
        .replace(/{visible}/gi, visible);


/*
        console.log("este el el diputado punto nombre");
        console.log(diputado.nombre);

        console.log("este el el bloque punto partido");
        console.log(bloque.partido);

        console.log(bloques[bloque.partido]["funcionarios"][diputado.nombre]["status"]);
  
  */      

        
        if (marta['data'][bloque.partido]["funcionarios"][diputado.nombre]["status"] == "respondido"){
            $('[data-render=bloque-items-ok]').append( htmlDiputados );
        }else{

          $('[data-render=bloque-items]').append( htmlDiputados );
        }





      },
      HeaderPregunta: function(bloque, diputado){

        var htmlHeaderPreguntas = templates.header_preguntas;

        htmlHeaderPreguntas = htmlHeaderPreguntas
        .replace(/{nombre}/gi, diputado.nombre)
        .replace(/{id}/gi, diputado.nombre.replace(/ /g, "-"))
        .replace(/{provincia}/gi, diputado.provincia)
        .replace(/{partido}/gi, bloque.partido)
        .replace(/{foto}/gi, diputado.foto);

        $('[data-render=bloque-item-detalle]').append( htmlHeaderPreguntas );
      },
      Pregunta: function(bloque, diputado, pregunta){
        var statusPublicado = pregunta.publicado.substring(0, 1); 
        var miRespuestaFinal =           
        miObservacionFinal = 
        alerta = "";

        if (pregunta.publicado !== "") {
          if (pregunta.respuestafinalmodifica == ""){
              miRespuestaFinal = '<div><h3 class="text-primary">Respuesta</h3>' + ' <p class="lead">' + pregunta.respuestafinal + '</p></div>';
          }
          else {
            miRespuestaFinal = '<div><h3 class="text-primary">Respuesta</h3>' + ' <p class="lead">' + pregunta.respuestafinalmodifica + '</p></div>';
          }


          $('.show-observaciones').removeClass('hidden');

          if (pregunta.observacionmodificada == ""){
              miObservacionFinal = '<div><h3 class="text-primary">Observacion</h3>' + ' <p class="lead">' + pregunta.observacion + '</p></div>';
          }
          else {
            miObservacionFinal = '<div><h3 class="text-primary">Observacion</h3>' + ' <p class="lead">' + pregunta.observacionmodificada + '</p></div>';
          }              

          if (statusPublicado == "2"){
              var alerta = "<div class='alert alert-warning'><div class='media'><div class='media-left'><i class='material-icons'>insert_drive_file</i></div> <div class='media-body ml-2'><p class='lead mt-1'>Ver respuesta en papel</p></div></div></div>";
          }
          if (statusPublicado == "3"){
              var alerta = "<div class='alert alert-danger'><div class='media'><div class='media-left'><i class='material-icons'>info_outline</i></div> <div class='media-body ml-2'> <p class='lead mt-1'>Se recomienda no contestar esta pregunta</p></div></div></div>";
          }
        }

        var htmlPreguntas = templates.preguntas;

        htmlPreguntas = htmlPreguntas
        .replace(/{index}/gi, bloque.index)
        .replace(/{partido}/gi, bloque.partido)
        .replace(/{foto}/gi, diputado.foto)
        .replace(/{pregunta}/gi, pregunta.pregunta)
        .replace(/{keyword}/gi, pregunta.keyword)
        .replace(/{provincia}/gi, diputado.provincia)
        .replace(/{numero}/gi, pregunta.numero)
        .replace(/{respuestageneral}/gi, pregunta.respuestageneral)
        .replace(/{respuestageneralstatu}/gi, pregunta.respuestageneralstatu)
        .replace(/{respuestapolitica}/gi, pregunta.respuestapolitica)
        .replace(/{respuestapoliticastatus}/gi, pregunta.respuestapoliticastatus)
        .replace(/{miRespuestaFinal}/gi, miRespuestaFinal)
        .replace(/{respuestaseleccionada}/gi, pregunta.respuestaseleccionada)
        .replace(/{miObservacionFinal}/gi, miObservacionFinal)
        .replace(/{observacionseleccioanda}/gi, pregunta.observacionseleccioanda)
        .replace(/{okmoderador}/gi, pregunta.okmoderador)
        .replace(/{nousar1}/gi, pregunta.nousar1)
        .replace(/{nousar2}/gi, pregunta.nousar2)
        .replace(/{nousar3}/gi, pregunta.nousar3)
        .replace(/{publicado}/gi, pregunta.publicado)
        .replace(/{timestamp}/gi, pregunta.timestamp)
        .replace(/{alerta}/gi, alerta);


        var select = '[data-pregunta-of-diputado="' + diputado.nombre.replace(/ /g, "-") + '"] [data-render=bloque-item-detalle-container]';
        $(select).append( htmlPreguntas );


      },
    }

};

    todo();
    cambiarCirculo();
    grisar();

/*
    setTimeout(function(){ 

      var listadiputados = new Array();
      var totaldepreguntas = new Array();

      $('[data-render="bloque-item-detalle"]').children().each(function( index ) {


        // hace un array con todos los nombres de diputados 
        var coso = $(this).attr("data-pregunta-of-diputado");
        coso = coso.replace(/-/g," ");
        listadiputados.push(coso);



        // hace un array con la cantidad total de preguntas

        var otrocoso = $(this).find('.owl-stage').context.children[1].childElementCount;
        
//      var otrocoso = $(this).find('.owl-item').length;

        console.log(otrocoso);

        totaldepreguntas.push(otrocoso);    

      });

      console.log(totaldepreguntas);

      var mimi = 0;

       $('.contenedorvacio').each(function() {


            $('.contenedorvacio:eq(0)').text(totaldepreguntas[mimi]);

            $('.contenedorvacio:eq(0)').removeClass('contenedorvacio');

            mimi ++;
        });


      //var preguntastotales = $('[data-diputado="' + nombreTerminarApasar + '"]')
      // data-render="bloque-item-detalle"
      //preguntasrespondidas

    }, 2000);

*/



    setTimeout(function(){ 


      $('.borrarTodo').click(function() {
        if (confirm('Est√°s seguro que quer√©s borrar todo?')) {
          localStorage.clear();
          location.reload();
        }
      });

    }, 1000);
    

    setTimeout(function(){ 
      $(".terminar").click(function(){
      
        
        var bloqueTerminar = $(this).parents(".media").find(".partidoTerminar").html();

        var nombreTerminar = $(this).parents(".media").find(".nombrefuncionario").html();


        marta['data'][bloqueTerminar]["funcionarios"][nombreTerminar]["status"] = "respondido";

        Lockr.set('bloques', marta['data']);

        var estadoTerminar = bloques[bloqueTerminar]["funcionarios"][nombreTerminar]["status"];

      var nombreTerminarApasar = nombreTerminar.replace(/ /g,"-");



      var funcionarioRespondido = $('[data-diputado="' + nombreTerminarApasar + '"]').clone();

      funcionarioRespondido.addClass('agregado');


      $('[data-diputado="' + nombreTerminarApasar + '"]').remove();

      $('[data-render="bloque-items-ok"]').append(funcionarioRespondido);


      $('.card-header-pregunta').removeClass('visible');
      $('.card-header-pregunta').addClass('d-none');

      $('.card-pregunta').removeClass('visible');
      $('.card-pregunta').addClass('d-none');

      $('#bloque-item-detalle').removeClass('visible');
      $('#bloque-item-detalle').addClass('d-none');
      
      $('#bloque-items').removeClass('d-none');
      $('#bloque-items').addClass('visible');

      cambiarCirculo();
      grisar();
    
      });


    }, 2000);


 $('.refreshPartido').click(function(){

      sessionStorage.setItem("reloading", "true");
      location.reload();

    });



 $('.refreshBloque').click(function(){

      location.reload();

    });



 function actualizarBloque() {

    setTimeout(function(){

      $('.loader').removeClass('visible');
      $('.loader').addClass('d-none');

      $('#bloques').removeClass('visible');
      $('#bloques').addClass('d-none');

      $('#bloque-item-detalle').removeClass('visible');
      $('#bloque-item-detalle').addClass('d-none');
      
      $('#bloque-items').removeClass('d-none');
      $('#bloque-items').addClass('visible');

      $('.agregado').remove();

    }, 1000);

    cambiarCirculo();
  }



  function cambiarCirculo(){

    setTimeout(function(){

      // cambia el X/X por un check a los respondidos

      $('[data-render="bloque-items-ok"] .circulocantidades').addClass('d-none');
      $('[data-render="bloque-items-ok"] .circulocantidades').removeClass('visible');

      $('[data-render="bloque-items-ok"] .circulocheck').addClass('visible');
      $('[data-render="bloque-items-ok"] .circulocheck').removeClass('d-none');



      // cambia el color del circulo en base a las contestadas

      $('.circulocantidades').each(function() {

        // console.log($(this).find('.preguntasrespondidas').html());


        if(($(this).find('.preguntasrespondidas').html()) == ($(this).find('.preguntastotales').html())){
         
          $(this).find('span').addClass('circuloverde');

        }else if(($(this).find('.preguntasrespondidas').html()) == 0){

          $(this).find('span').addClass('circulorojo');

        }else if((($(this).find('.preguntasrespondidas').html()) > 0) && (($(this).find('.preguntasrespondidas').html()) < ($(this).find('.preguntastotales').html()))){

          $(this).find('span').addClass('circuloamarillo');

        }


      });





    }, 1000);

  }

    function grisar(){

      setTimeout(function(){

      $('[data-render="bloque-items-ok"]').each(function(){

        $(this).find('img').addClass('imagengris');

      });


        }, 1000);

    }



  

  });

     
</script>

<script type="text/javascript">
  (function($) {

    $('#bloque-items .volver').on('click', function(){
      $('.card-diputado').removeClass('visible');
      $('.card-diputado').addClass('d-none');

      $('#bloque-items').removeClass('visible');
      $('#bloque-items').addClass('d-none');

      $('#bloques').removeClass('d-none');
      $('#bloques').addClass('visible');
    });

    $('#bloque-item-detalle .volver').on('click', function(){
      $('.card-header-pregunta').removeClass('visible');
      $('.card-header-pregunta').addClass('d-none');

      $('.card-pregunta').removeClass('visible');
      $('.card-pregunta').addClass('d-none');

      $('#bloque-item-detalle').removeClass('visible');
      $('#bloque-item-detalle').addClass('d-none');
      
      $('#bloque-items').removeClass('d-none');
      $('#bloque-items').addClass('visible');

    });
  
})(jQuery);
</script>

	</body>
</html>

